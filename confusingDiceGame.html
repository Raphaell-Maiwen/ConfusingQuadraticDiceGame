<!DOCTYPE html>
<html>
	<head>
		<title>Quadratic dice game</title>
		<meta charset = "UTF-8"></meta>
	</head>
	<body>
		<div id = "sheet">
			<p>This game is based on the quadratic equation (ax^2 + bx + c).
			<br>Each game, a 20-faced die is thrown to determine the value of x. It's the same for all players.
			<br>A 6-faced die is thrown, setting the number of quadratic equations every players will have to do.
			<br>To do a quadratic equations, a player throw three 12-sized dice. To each one correspond a variable (a, b and c).
			<br>After the system computes the results, all the digits for the results are converted into a letter. 
			<br>0 = a, 1 = b, 2 = c, 3 = d, 4 = e, 5 = f, 6 = g, 7 = h, 8 = i, 9 = j.
			<br>The rate of vowel is then computed. The player with the highest rate wins.
			<br>I had fun making this game; I don't expect you to do so.
			<br>Press on space to roll the dice. 
			</p>
		</div>
		<canvas>
		</canvas>
		<script>
			//Make the players throw the x and rollsToDo dice?
			var a;
			var b;
			var c;
			var x = Math.floor((Math.random() * 20)+1);
			console.log("x: " + x);

			var rollsToDo = Math.floor((Math.random() * 6)+1);
			console.log("rollsToDo: " + rollsToDo);
			var quadResult;
			var lettersResult = "";

			var allRates = [];
			var playersNum = 3; //Might be customized

			window.addEventListener("keydown", getKey, false);

			function getKey(e){
				if (e.keyCode == 32){
					for(var i = 0; i < rollsToDo; i++){
						compute();
					}
					console.log("lettersResult before: " + lettersResult);
					lettersResult = converse(lettersResult);
					console.log("lettersResult after: " + lettersResult);

					var rate = vowelRate(lettersResult);
					console.log("Rate: " + rate);

					//sheet.innerHTML += "<p>";
					sheet.innerHTML += "<br>" + "Rate: " + rate;
					sheet.innerHTML += "</p>";
					lettersResult = "";

					allRates.push(rate);
					if(allRates.length == playersNum){
						//TODO: Manage case where it's a tie.
						winner = end(allRates);
						sheet.innerHTML += "<p>";
						if(winner != -1){
							sheet.innerHTML += "Winner: Player " + winner;
						}
						else{
							sheet.innerHTML += "It's a tie.";
						}
						sheet.innerHTML += "</p>";
						allRates.splice(0, allRates.length);

						x = Math.floor((Math.random() * 20)+1);
						console.log("x: " + x);

						rollsToDo = Math.floor((Math.random() * 6)+1);
						console.log("rollsToDo: " + rollsToDo);
					}
				}
			}

			function compute(){
				sheet.innerHTML += "<p>";
				a = Math.floor((Math.random() * 12)+1);
				console.log("a: " + a);
				b = Math.floor((Math.random() * 12)+1);
				console.log("b: " + b);
				c = Math.floor((Math.random() * 12)+1);
				console.log("c: " + c);
				//TODO WHY :(
				//sheet.innerHTML += a + "(" + x + ")^2 + " + b + "(" + x + ") + " + c " = ";

				quadResult = a * Math.pow(x, 2) + b * x + c;
				sheet.innerHTML += quadResult;
				console.log("quadResult: " + quadResult);

				lettersResult += quadResult;
			}

			function converse(lettersResult){
				var letlet = "";
				for(var i = 0; i < lettersResult.length; i++){
					if(lettersResult[i] == 0){
						letlet += 'a';
					}
					else if(lettersResult[i] == 1){
						letlet += 'b';
					}
					else if(lettersResult[i] == 2){
						letlet += 'c';
					}
					else if(lettersResult[i] == 3){
						letlet += 'd';
					}
					else if(lettersResult[i] == 4){
						letlet += 'e';
					}
					else if(lettersResult[i] == 5){
						letlet += 'f';
					}
					else if(lettersResult[i] == 6){
						letlet += 'g';
					}
					else if(lettersResult[i] == 7){
						letlet += 'h';
					}
					else if(lettersResult[i] == 8){
						letlet += 'i';
					}
					else{
						letlet += 'j';
					}
				}
				return letlet;
			}

			function vowelRate(lettersResult){
				var vowel = 0;

				for(var i = 0; i < lettersResult.length; i++){
					if(lettersResult[i] == 'a' || lettersResult[i] == 'e' || lettersResult[i] == 'i'){
						vowel++;
					}
				}
				console.log("Vowels: " + vowel);
				if(vowel == 0){
					return 0;
				}
				else{
					return lettersResult.length / vowel;
				}
			}

			function end(allRates){
				var winner = -1;
				var highestRate = 0;
				for(var i = 0; i < allRates.length; i++){
					if(allRates[i] > highestRate){
						highestRate = allRates[i];
						winner = i+1;
					}
					else if(allRates[i] == highestRate){
						winner = -1;
					}
				}
				return winner;
			}
		</script>
	</body>
</html>
